# FunnelSync Backend

–ë—ç–∫–µ–Ω–¥ —á–∞—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞ FunnelSync - –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä–∞ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–µ–π —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏.

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- NestJS
- MongoDB
- Socket.IO
- Telegram Bot API
- JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
npm install
```

2. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏:
```
MONGODB_URI=mongodb://localhost:27017/funnelsync
JWT_SECRET=your-secret-key
TELEGRAM_BOT_TOKEN=your-telegram-bot-token
```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
```bash
npm run start:dev
```

## üìö API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

#### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
```http
POST /auth/register
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password123",
  "name": "John Doe"
}
```
**–û–ø–∏—Å–∞–Ω–∏–µ:** –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.  
**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**  
- `email` (string): Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º).  
- `password` (string): –ü–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.  
- `name` (string): –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.  
**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –û–±—ä–µ–∫—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–±–µ–∑ –ø–∞—Ä–æ–ª—è).  
**–û—à–∏–±–∫–∏:**  
- 400 Bad Request: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç".

#### –í—Ö–æ–¥
```http
POST /auth/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password123"
}
```
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT-—Ç–æ–∫–µ–Ω.  
**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**  
- `email` (string): Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.  
- `password` (string): –ü–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.  
**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –û–±—ä–µ–∫—Ç —Å –ø–æ–ª—è–º–∏ `access_token` (JWT-—Ç–æ–∫–µ–Ω) –∏ `user` (–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è).  
**–û—à–∏–±–∫–∏:**  
- 401 Unauthorized: "Invalid credentials".

### Telegram

#### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ Telegram
```http
POST /telegram/connect
Authorization: Bearer <jwt-token>
Content-Type: application/json

{
  "accessToken": "your-telegram-bot-token"
}
```
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–¥–∫–ª—é—á–∞–µ—Ç Telegram-–±–æ—Ç–∞ –∫ –ø—Ä–æ—Ñ–∏–ª—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.  
**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**  
- `accessToken` (string): –¢–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –æ—Ç BotFather.  
**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –û–±—ä–µ–∫—Ç —Å –ø–æ–ª–µ–º `success: true` –∏ –¥–∞–Ω–Ω—ã–º–∏ –±–æ—Ç–∞ (`botInfo`).  
**–û—à–∏–±–∫–∏:**  
- 400 Bad Request: "This Telegram bot is already connected and active" –∏–ª–∏ –¥—Ä—É–≥–∏–µ –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤
```http
GET /telegram/accounts
Authorization: Bearer <jwt-token>
```
**–û–ø–∏—Å–∞–Ω–∏–µ:** –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö Telegram-–∫–∞–Ω–∞–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.  
**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –ú–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ —Å –¥–∞–Ω–Ω—ã–º–∏ –∫–∞–Ω–∞–ª–æ–≤ (id, username, firstName, lastName, isActive, lastSync).  
**–û—à–∏–±–∫–∏:**  
- 404 Not Found: "User not found".

#### –û—Ç–∫–ª—é—á–µ–Ω–∏–µ Telegram-–±–æ—Ç–∞
```http
POST /telegram/disconnect/:channelId
Authorization: Bearer <jwt-token>
```
**–û–ø–∏—Å–∞–Ω–∏–µ:** –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É Telegram-–±–æ—Ç–∞, –Ω–æ –Ω–µ —É–¥–∞–ª—è–µ—Ç –∫–∞–Ω–∞–ª –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.  
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**  
- `channelId` (string): –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–∞–Ω–∞–ª–∞.  
**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –û–±—ä–µ–∫—Ç —Å –ø–æ–ª–µ–º `success: true`.  
**–û—à–∏–±–∫–∏:**  
- 404 Not Found: "Bot is not running for this user".

#### –£–¥–∞–ª–µ–Ω–∏–µ Telegram-–∫–∞–Ω–∞–ª–∞
```http
POST /telegram/delete/:channelId
Authorization: Bearer <jwt-token>
```
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ—Ç Telegram-–∫–∞–Ω–∞–ª –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.  
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**  
- `channelId` (string): –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–∞–Ω–∞–ª–∞.  
**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –û–±—ä–µ–∫—Ç —Å –ø–æ–ª–µ–º `success: true`.  
**–û—à–∏–±–∫–∏:**  
- 404 Not Found: "Telegram channel not found".

#### –ó–∞–ø—É—Å–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ Telegram-–∫–∞–Ω–∞–ª–∞
```http
POST /telegram/start/:channelId
Authorization: Bearer <jwt-token>
```
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ä–∞–Ω–µ–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Telegram-–∫–∞–Ω–∞–ª.  
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**  
- `channelId` (string): –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–∞–Ω–∞–ª–∞.  
**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –û–±—ä–µ–∫—Ç —Å –ø–æ–ª–µ–º `success: true`.  
**–û—à–∏–±–∫–∏:**  
- 404 Not Found: "Telegram channel not found or accessToken missing".
- 400 Bad Request: "Bot is already running for this user".

#### –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram
```http
POST /telegram/send-message
Authorization: Bearer <jwt-token>
Content-Type: application/json

{
  "chatId": "123456789",
  "message": "Hello, world!"
}
```
**–û–ø–∏—Å–∞–Ω–∏–µ:** –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∞–∫—Ç–∏–≤–Ω—ã–π Telegram-–±–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.  
**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**  
- `chatId` (string): –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —á–∞—Ç–∞ –≤ Telegram.  
- `message` (string): –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.  
**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –û–±—ä–µ–∫—Ç —Å –ø–æ–ª–µ–º `success: true`.  
**–û—à–∏–±–∫–∏:**  
- 404 Not Found: "No active Telegram channel found".
- 400 Bad Request: "Failed to send message".

### WebSocket API

#### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket
```javascript
const socket = io('http://localhost:3000', {
  auth: {
    token: 'your-jwt-token'
  }
});
```
**–û–ø–∏—Å–∞–Ω–∏–µ:** –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º.  
**–°–æ–±—ã—Ç–∏—è WebSocket:**

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:**
   ```javascript
   socket.on('unreadMessages', (messages) => {
     console.log('Unread messages:', messages);
   });
   ```

2. **–ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞:**
   ```javascript
   socket.on('chatHistory', (history) => {
     console.log('Chat history:', history);
   });
   ```

3. **–ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:**
   ```javascript
   socket.on('newMessage', (msg) => {
     console.log('New message:', msg);
   });
   ```

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞ –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ Telegram-–±–æ—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è.
- –ï—Å–ª–∏ –±–æ—Ç –Ω–µ —É–¥–∞—ë—Ç—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å, –µ–≥–æ —Å—Ç–∞—Ç—É—Å (`isActive`) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `false`.
- –í—Å–µ –æ—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ HTTP-—Å—Ç–∞—Ç—É—Å–∞–º–∏ –∏ –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏.

## üèó –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ auth/              # –ú–æ–¥—É–ª—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ dto/          # Data Transfer Objects
‚îÇ   ‚îú‚îÄ‚îÄ guards/       # JWT Guard
‚îÇ   ‚îú‚îÄ‚îÄ strategies/   # JWT Strategy
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ chat/             # –ú–æ–¥—É–ª—å —á–∞—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ schemas/      # –°—Ö–µ–º—ã MongoDB
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ common/           # –û–±—â–∏–µ –º–æ–¥—É–ª–∏
‚îú‚îÄ‚îÄ telegram/         # –ú–æ–¥—É–ª—å Telegram
‚îÇ   ‚îú‚îÄ‚îÄ schemas/      # –°—Ö–µ–º—ã MongoDB
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ users/            # –ú–æ–¥—É–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    ‚îú‚îÄ‚îÄ schemas/      # –°—Ö–µ–º—ã MongoDB
    ‚îî‚îÄ‚îÄ ...
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º bcrypt
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –ó–∞—â–∏—Ç–∞ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

`be_v0.1` –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω –Ω–∞ —É—Å–ª–æ–≤–∏—è—Ö –ª–∏—Ü–µ–Ω–∑–∏–∏ Boost Software. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª–µ [LICENSE_1_0.txt](http://www.boost.org/LICENSE_1_0.txt)
